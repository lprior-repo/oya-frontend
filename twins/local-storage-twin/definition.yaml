# LocalStorage Digital Twin Definition
# Simulates browser localStorage API for development/testing

twin:
  name: local-storage
  display_name: "Browser LocalStorage"
  version: "1.0"
  description: "Simulates browser localStorage for workflow persistence"

  auth:
    type: none

  state:
    collections:
      workflows:
        schema:
          id: { type: string, generated: true }
          name: { type: string }
          nodes: { type: array }
          connections: { type: array }
          created_at: { type: datetime, auto: true }
          updated_at: { type: datetime, auto: true }

      nodes:
        schema:
          id: { type: string }
          node_type: { type: string }
          position: { type: object }
          data: { type: object }

      connections:
        schema:
          id: { type: string }
          source_node: { type: string }
          target_node: { type: string }
          source_port: { type: string }
          target_port: { type: string }

      execution_results:
        schema:
          id: { type: string, generated: true }
          workflow_id: { type: string }
          node_count: { type: number }
          execution_time_ms: { type: number }
          success: { type: boolean }
          output: { type: object }
          executed_at: { type: datetime, auto: true }

  handlers:
    POST /storage/workflow:
      description: "Save workflow to storage"
      action: create
      collection: workflows
      response:
        status: 200

    GET /storage/workflow/{id}:
      description: "Get workflow by ID"
      action: read
      collection: workflows
      not_found:
        status: 404

    GET /storage/workflows:
      description: "List all workflows"
      action: list
      collection: workflows

    PUT /storage/workflow/{id}:
      description: "Update workflow"
      action: update
      collection: workflows

    DELETE /storage/workflow/{id}:
      description: "Delete workflow"
      action: delete
      collection: workflows
      response:
        status: 200

    POST /storage/execution-result:
      description: "Store execution result"
      action: create
      collection: execution_results

    GET /storage/execution-results:
      description: "List execution results"
      action: list
      collection: execution_results

    DELETE /storage/clear:
      description: "Clear all storage"
      action: reset_all
      response:
        status: 200

  inspection:
    GET /__twin/workflows:
      description: "Get all workflows"
      action: list
      collection: workflows

    GET /__twin/health:
      description: "Health check"
      action: health

    DELETE /__twin/state:
      description: "Reset all twin state"
      action: reset_all
