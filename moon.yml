$schema: "https://moonrepo.dev/schemas/project.json"

tasks:
  serve:
    command: "sh -c 'fuser -k 8081/tcp || true; dx serve --platform web --port 8081'"
    options:
      cache: false

  check:
    command: "cargo check"

  test:
    command: "cargo test"

  e2e:
    command: "node_modules/.bin/playwright test"
    options:
      cache: false

  clippy:
    command: "cargo clippy -- -D warnings -D clippy::unwrap_used -D clippy::expect_used -D clippy::panic"

  fmt:
    command: "cargo fmt --check"

  build-web:
    command: "dx build --platform web"

  coverage:
    command: "cargo llvm-cov --summary-only"

  coverage-core:
    command: "cargo llvm-cov --summary-only --ignore-filename-regex '(src/main.rs|src/bin/|src/ui/|src/hooks/)'"

  ci:
    script: |
      cargo check
      cargo test
      cargo clippy -- -D warnings -D clippy::unwrap_used -D clippy::expect_used -D clippy::panic
      node_modules/.bin/playwright test
